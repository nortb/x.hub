class Chat{constructor({appid:e=""}={}){this.appid=e,this.user="",this.sessionId="",this.company={id:"",name:""},this.open=!1,this.loaded=!1,this.load(this.appid),this.logo="",this.firstMessage="",this.createStyles(),this.ticket={problem:"",name:"",email:""},this.activeTag="",this.action=-99,this.nextStep="",this.menu=""}createStyles(){const e=document.createElement("style");document.head.appendChild(e),e.innerHTML="\n            span{\n                font-family: 'Roboto', 'Arial', sans-serif;\n            }\n            .nametag{\n                font-family: 'Roboto', 'Arial', sans-serif;\n                letter-spacing: 1px;\n            }\n            .containeri{\n                bottom: 20px;\n                right: 30px;\n                position: fixed;\n           \n            }\n            .button-container {\n                background-color: #000;\n                width: 50px;\n                height: 50px;\n                border-radius: 50%;\n                box-shadow: 0px 0px 31px 6px rgba(0,0,0,0.75);\n                transition: all 1s ease-in-out;\n            }\n            .button-container2 {\n                display: flex;\n                width: 250px;\n                height: 50px\n                flex-direction: row;\n                align-items: flex-end;\n                transition: all 1s ease-in-out;\n                \n            }\n            .icon{\n                cursor: pointer;\n                width: 50%;\n                position: absolute;\n                left: 50%;\n                margin-left: -12.5px;\n                top: 50%;\n                margin-top: -12.5px;\n                transition: transform .3s ease;\n            }\n\n            .imageCont {\n                min-width: 20px;\n                max-width: 20px;\n                max-height: 20px;\n                object-fit: cover;\n                border-radius: 50%;\n                margin-right: 5px;\n                transition: transform 1s ease;\n         \n            }\n            .initMessageCont{\n                border-radius: 10px;\n                background-color: #fff;\n                margin-left: 5px;\n                padding: 10px;\n                display: flex;\n                flex-direction: column;\n                cursor: pointer;\n                transition: transform 1s ease;\n            }\n            \n            .hidden{\n                transform: scale(0);\n            }\n         \n         \n       \n         \n            \n            .message-container{\n                box-shadow: 0 0 25px 18px rgba(0,0,0,0.1);\n                width: 300px;\n                right: 0px;\n                max-height: 500px;\n                bottom: 30px;\n                position: absolute;\n                transition:  all .5s ease;\n                font-family: Helvetica, Arial, sans-serif;\n                z-index: 999;\n                background-color: white;\n            }\n            \n            .message-container.hidden {\n                max-height: 0px;\n            }\n            \n            .message-container header{\n                display: flex;\n                flex-direction: column;\n                justify-content: flex-start\n            }\n            \n            .message-container h2{\n                margin: 0;\n                font-size: 14px;\n                padding: 20px 20px 0px 20px;\n                color: #fff;\n            }\n            \n            .message-container p{\n                margin: 0;\n                font-size: 12px;\n                font-weight: 300;\n                padding: 0px 20px 20px;\n                color: #ddd;\n            }\n            \n            .AIBOT{\n                min-height: 400px;\n                max-height: 400px;\n                overflow: auto;\n                padding: 20px;\n                display: flex;\n                flex-direction: column;\n                transition: all .5 ease-in;\n                scroll-behavior: smooth;\n            }\n            \n            .messageAI{\n                 margin-bottom: 5px;\n                 margin-top: 5px;\n                 max-width: 50%;\n                 left: 10px;\n                 color: #fff\n                 padding: 20px;\n                 border-radius: 5px;\n                 color: white;\n                 font-size: 14px;\n                 opacity: 0;\n                 transition: all 0.5s;\n            }\n            \n            .messageUser{\n                max-width: 50%;\n                margin-bottom: 5px;\n                margin-top: 5px;\n                align-self: flex-end;\n                right: 10px;\n                background-color: #efefef;\n                padding: 20px;\n                \n                font-size: 14px;\n                cursor: pointer;\n                opacity: 0;\n                transition: all 0.5s;\n                \n            }\n            .messageUser2{\n                max-width: 50%;\n                margin-bottom: 5px;\n                margin-top: 5px;\n                border: 1px solid grey;\n                align-self: flex-end;\n                right: 10px;\n                background-color: white;\n                border-radius: 10px;\n                font-size: 13px;\n                cursor: pointer;\n                opacity: 0;\n                transition: all 0.5s;\n            }\n            \n            .sendMenu{\n                display: flex;\n                flex-direction: row;\n                align-items: center;\n                max-height: 50px;\n                padding: 5px;\n                fontSize: 14px;\n            }\n            \n            input {\n                padding: 10px;\n                width: 80%;\n                border: none;\n                border-bottom: 2px solid #ddd;\n            }\n            \n            .icon2 {\n                width: 30px;\n                height: 30px;\n                padding-left: 5px;\n                cursor: pointer;\n                align-self: center;\n            }\n            "}async load(e){const t=await fetch("https://geolocation-db.com/json/",{method:"GET"}),s=await t.json(),n=await fetch("https://hubpluginserver.azurewebsites.net/companies/company",{method:"POST",headers:{authorization:e},body:JSON.stringify({IPv4:s.IPv4})}),i=await n.json();if(i.error)return this.loaded=!1;i.session.id&&(this.sessionId=this.sessionId),this.company={...i},this.ticket={enterprise:i.type=1},this.loaded=!0,this.initialise(this.company)}async initialise(e){if(await new Promise(e=>setTimeout(e,500)),console.log(e),0===e.ball){const t=document.createElement("div");t.classList.add("containeri"),document.body.appendChild(t);const s=document.createElement("div");s.classList.add("button-container"),s.style.backgroundColor=e.color,s.style.opacity=0,s.style.transform="translateY(20px)",setTimeout(()=>{s.style.opacity=1},500),setTimeout(()=>{s.style.transform="translateY(0px)"},500);const n=document.createElement("img");n.src="https://www.nortb.com/img/chat1.svg",n.classList.add("icon"),this.chatIcon=n;const i=document.createElement("img");i.src="https://www.nortb.com/img/chat2.svg",i.classList.add("icon","hidden"),this.closeIcon=i,this.container=t,this.buttonContainer=s,t.appendChild(s),s.appendChild(this.chatIcon),s.appendChild(this.closeIcon),s.addEventListener("click",this.toggleOpen.bind(this)),s.classList.add("nonopac")}else{const t=document.createElement("div");t.classList.add("containeri"),document.body.appendChild(t);const s=await fetch("https://hubpluginserver.azurewebsites.net/companies/companyBall",{method:"POST",headers:{authorization:appid,"Content-Type":"application/json"},body:JSON.stringify({id:e.id})}),n=await s.json(),i=document.createElement("div");i.classList.add("button-container2"),i.style.opacity=0,i.style.transform="translateY(20px)",setTimeout(()=>{i.style.opacity=1},500),setTimeout(()=>{i.style.transform="translateY(0px)"},500);const a=document.createElement("img");a.classList.add("imageCont"),a.classList.add("visible"),a.src=n.img,this.imageIcon=a;const o=document.createElement("div");o.classList.add("initMessageCont"),this.messageInti=o;let d=document.createElement("span");d.innerText=n.message.message,d.style.fontSize="14px",d.style.color="#444";let r=document.createElement("span");r.classList.add("nametag"),r.innerText=`${n.name} from HUB`,r.style.fontSize="12px",r.style.color="#777",this.message=d,this.message2=r,o.appendChild(this.message2),o.appendChild(this.message);const c=document.createElement("img");c.src="https://www.nortb.com/img/chat2.svg",c.classList.add("icon","hidden"),this.closeIcon=c,this.container=t,this.buttonContainer=i,t.appendChild(i),i.appendChild(this.imageIcon),i.appendChild(this.messageInti),i.appendChild(this.closeIcon),i.addEventListener("click",this.toggleOpen.bind(this))}}addLoadingMessage(){const e=document.createElement("div");e.id="loading",e.classList.add("messageAI"),e.innerText="Loadingâ€¦",e.style.opacity=1,e.style.padding="20px",this.loadingMessage=e,this.messageViwer.appendChild(e).scrollIntoView({behavior:"smooth"})}removeLoadinMessage(){this.messageViwer.removeChild(this.loadingMessage)}async createSession(){const e=await fetch("https://geolocation-db.com/json/",{method:"GET"}),t=await e.json(),s=await fetch("https://hubpluginserver.azurewebsites.net/sessions/createSession",{method:"POST",headers:{authorization:this.appid,"Content-type":"application/json"},body:JSON.stringify({IPv4:t.IPv4,company:this.company.id})}),n=await s.json();this.userId=n.userId,this.sessionId=n.id}toggleOpen(){this.loaded&&(this.open=!this.open,this.open?(""===this.sessionId?this.createSession():console.log("did not created a session"),0===this.company.ball?this.chatIcon.classList.add("hidden"):this.imageIcon.classList.add("hidden"),0===this.company.ball?this.closeIcon.classList.remove("hidden"):this.messageInti.classList.add("hidden"),this.showMessageContainer()):(this.chatIcon.classList.remove("hidden"),this.messageContainer.classList.add("hidden"),this.closeIcon.classList.add("hidden")))}showMessageContainer(){this.messageContainer=document.createElement("div"),this.messageContainer.style.borderRadius="10px",this.messageContainer.classList.add("message-container"),this.messageContainer.style.opacity=0,this.messageContainer.style.transform="translateY(20px)",setTimeout(()=>{this.messageContainer.style.opacity=1},500),setTimeout(()=>{this.messageContainer.style.transform="translateY(0px)"},500);const e=document.createElement("div");e.classList.add("header"),e.style.borderRadius="10px 10px 0px 0px",e.style.backgroundColor=this.company.color;const t=document.createElement("h2");t.textContent=this.company.header,t.style.color=this.company.color2,t.style.fontSize="32px";const s=document.createElement("p");s.textContent=this.company.sublime,s.style.color=this.company.color2;const n=document.createElement("img");n.src=this.company.logo,n.style.height="40px",n.style.marginLeft="15px",n.style.marginTop="15px",n.style.marginBottom="-15px",e.appendChild(n),e.appendChild(t),e.appendChild(s);const i=document.createElement("div");i.id="messageViewer",i.style.height="350px",i.style.backgroundColor="#efefef",i.style.overflowY="auto",i.style.padding="15px",i.style.display="flex",i.style.flexDirection="column",this.messageViwer=i,this.loadFirstMessage();const a=document.createElement("div");a.classList.add("sendMenu"),a.classList.add("hidden");const o=document.createElement("input");o.style.outline="none",o.style.width="100%",o.style.fontSize="14px",o.required=!0,o.id="email",o.type="text",o.placeholder="message",o.addEventListener("keyup",e=>{"Enter"===e.key&&(e.preventDefault(),this.submitAction())}),a.appendChild(o),this.sendMenu=a,this.messageContainer.appendChild(e),this.messageContainer.appendChild(i),this.messageContainer.appendChild(a),this.container.appendChild(this.messageContainer)}messageUser(e){const t=document.createElement("span");return t.classList.add("messageUser"),t.innerText=e,t.style.opacity=1,t.style.borderRadius="10px",t}messageUser2(e,t){const s=document.createElement("div");return s.classList.add("messageUser2"),s.innerText=e,s.style.opacity=1,s.style.padding="5px 10px 5px 10px",s.addEventListener("click",()=>this.fetchNextStep(t)),s}messageAI(e){const t=document.createElement("div");return t.style.backgroundColor=this.company.color,t.classList.add("messageAI"),t.innerText=e.message,t.style.opacity=1,t.style.padding="20px",t.addEventListener("click",()=>this.fetchNextStep(e)),t}updateScroll(){var e=this.messageViwer;e.scrollTop=e.scrollHeight}delay(e){return new Promise(t=>setTimeout(t,e))}async loadFirstMessage(){this.addLoadingMessage();const e=await fetch(`https://hubpluginserver.azurewebsites.net/steps/firststep?id=${this.appid}`,{method:"GET"}),t=await e.json();if(!t.parent)return this.toggleOpen;this.removeLoadinMessage(),this.messageViwer.appendChild(this.messageAI(t.parent))}submitAction(){if(1===this.action){var e=document.querySelector("#email").value;""!==e.trim()&&(this.messageViwer.appendChild(this.messageUser(e)),this.ticket={...this.ticket,[this.activeTag]:e},this.fetchNextStep(this.nextStep),this.updateScroll(),document.querySelector("#email").value="")}}async fetchRepliers(e){const t=await fetch(`https://hubpluginserver.azurewebsites.net/steps/fetchstep?id=${e.id}`,{method:"GET"}),s=await t.json();if(-10===e.action)for(let e=0;e<s.steps.length;e++)this.messageViwer.appendChild(this.messageAI(s[e])),this.updateScroll();if(0===e.action){this.action=0;for(let e=0;e<s.steps.length;e++)await this.delay(500),this.messageViwer.appendChild(this.messageUser2(s.steps[e].message)),this.updateScroll()}1===s.action&&(this.action=0,this.ticket[s.tag]="",this.activeTag=s.tag,this.nextStep=s.childs[0],this.action=1,this.sendMenu.classList.remove("hidden"),this.updateScroll())}async fetchNextStep(e){this.addLoadingMessage();const t=await fetch(`https://hubpluginserver.azurewebsites.net/steps/fetchstep?id=${e.id}`,{method:"GET"}),s=await t.json();if(this.removeLoadinMessage(),-10===e.action)return-1===s.action?this.toggleOpen():(this.messageViwer.appendChild(this.messageAI(s.steps[0])),this.fetchNextStep(s.steps[0]));if(0===e.action){this.action=0;for(let e=0;e<s.steps.length;e++)await this.delay(500),this.messageViwer.appendChild(this.messageUser2(s.steps[e].message)),this.updateScroll()}if(1===s.action)for(let e=0;e<s.childs.length;e++)this.messageViwer.appendChild(this.messageAI(s.childs[e].message)),this.updateScroll(),this.fetchRepliers(s.childs[e]._id);if(1===s.action&&(this.messageViwer.appendChild(this.messageAI(s.message)),this.ticket[s.tag]="",this.activeTag=s.tag,this.nextStep=s.childs[0],this.action=1,this.sendMenu.classList.remove("hidden"),this.updateScroll()),2===s.action){this.updateScroll(),this.messageViwer.appendChild(this.messageAI(s.message)),""===this.ticket.company&&(this.ticket.company=this.company.name),this.ticket.companyid=this.company.id,this.ticket.user=this.userId,this.ticket.session=this.sessionId;const e=await fetch("https://hubpluginserver.azurewebsites.net/sessions/createticket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ticket:{...this.ticket}})});await e.json(),this.sendMenu.classList.add("hidden")}if(3===s.action){this.updateScroll(),this.messageViwer.appendChild(this.messageAI(s.message)),""===this.ticket.company&&(this.ticket.company=this.company.name),this.ticket.companyid=this.company.id,this.ticket.user=this.userId,this.ticket.session=this.sessionId;const e=await fetch("https://hubpluginserver.azurewebsites.net/sessions/createticket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ticket:{...this.ticket}})});await e.json(),this.sendMenu.classList.add("hidden")}}}let script=document.getElementById("nortbHUB"),appid=script.getAttribute("appid");export const chat=new Chat({appid:appid});
