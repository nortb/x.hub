class Chat{constructor({appid:e=""}){this.appid=e,this.user="",this.sessionId="",this.company={id:"",name:""},this.open=!1,this.loaded=!1,this.load(this.appid),this.logo="",this.firstMessage="",this.IPv4="",this.createStyles(),this.ticket={problem:"",name:"",email:"",customTags:[]},this.activeTag="",this.action=-99,this.nextStep="",this.menu="",this.text=""}delay(e){return new Promise(t=>setTimeout(t,e))}createStyles(){const e=document.createElement("style");document.head.appendChild(e),e.innerHTML="\n            span{\n                font-family: 'Roboto', 'Arial', sans-serif;\n            }\n            .nametag{\n                font-family: 'Roboto', 'Arial', sans-serif;\n                letter-spacing: 1px;\n            }\n            .containeri{\n                bottom: 20px;\n                right: 30px;\n                position: fixed;\n           \n            }\n            .button-container {\n                background-color: #000;\n                width: 50px;\n                height: 50px;\n                border-radius: 50%;\n                box-shadow: 0px 0px 31px 6px rgba(0,0,0,0.75);\n                transition: all 0.6s ease-in-out;\n            }\n            .button-container2 {\n                display: flex;\n                width: 250px;\n                height: 50px\n                flex-direction: row;\n                align-items: flex-end;\n                transition: all 0.6s ease-in-out;\n                \n            }\n            .icon{\n                cursor: pointer;\n                width: 50%;\n                position: absolute;\n                left: 50%;\n                margin-left: -12.5px;\n                top: 50%;\n                margin-top: -12.5px;\n                transition: transform .3s ease;\n            }\n\n            .imageCont {\n                min-width: 20px;\n                max-width: 20px;\n                max-height: 20px;\n                object-fit: cover;\n                border-radius: 50%;\n                margin-right: 5px;\n                transition: transform 0.6s ease;\n         \n            }\n            .initMessageCont{\n                border-radius: 10px;\n                background-color: #fff;\n                margin-left: 5px;\n                padding: 10px;\n                display: flex;\n                flex-direction: column;\n                cursor: pointer;\n                transition: transform 1s ease;\n            }\n            \n            .hidden{\n                transform: scale(0);\n            }\n         \n         \n       \n         \n            \n            .message-container{\n                box-shadow: 0 0 25px 18px rgba(0,0,0,0.1);\n                width: 350px;\n                right: 0px;\n                \n                bottom: 50px;\n                position: absolute;\n                transition:  all .5s ease;\n                font-family: Helvetica, Arial, sans-serif;\n                z-index: 999;\n                background-color: white;\n            }\n            \n            .message-container.hidden {\n                max-height: 0px;\n            }\n            \n            .message-container header{\n                display: flex;\n                flex-direction: column;\n                justify-content: flex-start\n            }\n            \n            .message-container h2{\n                margin: 0;\n                font-size: 14px;\n                padding: 20px 20px 0px 20px;\n                color: #fff;\n            }\n            \n            .message-container p{\n                margin: 0;\n                font-size: 12px;\n                font-weight: 300;\n                padding: 0px 20px 20px;\n                color: #ddd;\n            }\n            \n            .AIBOT{\n                min-height: 400px;\n                max-height: 400px;\n                overflow: auto;\n                padding: 20px;\n                display: flex;\n                flex-direction: column;\n                transition: all .5 ease-in;\n                scroll-behavior: smooth;\n            }\n            \n            .messageAI{\n                 margin-bottom: 5px;\n                 margin-top: 5px;\n                 max-width: 50%;\n                 left: 10px;\n                 color: #fff\n                 padding: 20px;\n                 border-radius: 5px;\n                 color: white;\n                 font-size: 14px;\n                 opacity: 0;\n                 transition: all 0.5s;\n            }\n   \n            .messageUser2{\n                max-width: 50%;\n                margin-bottom: 5px;\n                margin-top: 5px;\n                border: 1px solid grey;\n                align-self: flex-end;\n                right: 10px;\n                background-color: white;\n                border-radius: 10px;\n                font-size: 13px;\n                cursor: pointer;\n                opacity: 0;\n                transition: all 0.2s;\n            }\n            \n            .sendMenu{\n                display: flex;\n                flex-direction: row;\n                align-items: center;\n                fontSize: 14px;\n            }\n            \n            .input {\n                padding: 10px;\n                width: 80%;\n                border: none;\n                border-bottom: 2px solid #ddd;\n            }\n            \n            .icon2 {\n                width: 30px;\n                height: 30px;\n                padding-left: 5px;\n                cursor: pointer;\n                align-self: center;\n            }\n            "}async load(e){const t=await fetch("https://geolocation-db.com/json/",{method:"GET"}),s=await t.json();this.IPv4=s.IPv4;const n=await fetch("https://hubpluginserver.azurewebsites.net/companies/company",{method:"POST",headers:{"Content-type":"application/json",authorization:e},body:JSON.stringify({IPv4:s.IPv4})}),i=await n.json();if(i.error)return this.loaded=!1;i.session.id&&(this.sessionId=this.sessionId),this.company={...i},this.ticket={enterprise:i.type=1},this.loaded=!0,this.initialise(this.company)}async initialise(e){if(await new Promise(e=>setTimeout(e,500)),0===e.ball){const t=document.createElement("div");t.classList.add("containeri"),document.body.appendChild(t);const s=document.createElement("div");s.classList.add("button-container"),s.style.backgroundColor=e.color,s.style.opacity=0,s.style.transform="translateY(20px)",setTimeout(()=>{s.style.opacity=1},200),setTimeout(()=>{s.style.transform="translateY(0px)"},200);const n=document.createElement("img");n.src="https://www.nortb.com/img/chat1.svg",n.classList.add("icon"),this.chatIcon=n;const i=document.createElement("img");i.src="https://www.nortb.com/img/chat2.svg",i.classList.add("icon","hidden"),this.closeIcon=i,this.container=t,this.buttonContainer=s,t.appendChild(s),s.appendChild(this.chatIcon),s.appendChild(this.closeIcon),s.addEventListener("click",this.toggleOpen.bind(this)),s.classList.add("nonopac")}else{const t=document.createElement("div");t.classList.add("containeri"),document.body.appendChild(t);const s=await fetch("https://hubpluginserver.azurewebsites.net/companies/companyBall",{method:"POST",headers:{authorization:this.appid,"Content-Type":"application/json"},body:JSON.stringify({id:e.id})}),n=await s.json(),i=document.createElement("div");i.classList.add("button-container2"),i.style.opacity=0,i.style.transform="translateY(20px)",setTimeout(()=>{i.style.opacity=1},200),setTimeout(()=>{i.style.transform="translateY(0px)"},200);const a=document.createElement("img"),o=document.createElement("img");o.src="https://www.nortb.com/img/chat1.svg",o.classList.add("icon"),o.classList.add("hidden"),this.chatIcon=o,a.classList.add("imageCont"),a.classList.add("visible"),a.src=n.img,this.imageIcon=a;const d=document.createElement("div");d.classList.add("initMessageCont"),this.messageInti=d;let l=document.createElement("span");l.innerText=n.message.message,l.style.fontSize="14px",l.style.color="#444";let r=document.createElement("span");r.classList.add("nametag"),r.innerText=`${n.name} from HUB`,r.style.fontSize="12px",r.style.color="#777",this.message=l,this.message2=r,d.appendChild(this.message2),d.appendChild(this.message);const c=document.createElement("img");c.src="https://www.nortb.com/img/chat2.svg",c.classList.add("icon","hidden"),this.closeIcon=c,this.container=t,this.buttonContainer=i,t.appendChild(i),i.appendChild(this.imageIcon),i.appendChild(this.chatIcon),i.appendChild(this.messageInti),i.appendChild(this.closeIcon),i.addEventListener("click",this.toggleOpen.bind(this))}}addLoadingMessage(){const e=document.createElement("div");e.id="loading",e.classList.add("messageAI"),e.innerText="Loadingâ€¦",e.style.color="#777",e.style.opacity=1,e.style.padding="20px",this.loadingMessage=e,this.messageViwer.appendChild(e).scrollIntoView({behavior:"smooth"})}removeLoadinMessage(){this.messageViwer.removeChild(this.loadingMessage)}async createSession(){const e=await fetch("https://geolocation-db.com/json/",{method:"GET"}),t=await e.json(),s=await fetch("https://hubpluginserver.azurewebsites.net/sessions/createSession",{method:"POST",headers:{authorization:this.appid,"Content-type":"application/json"},body:JSON.stringify({IPv4:t.IPv4,company:this.company.id})}),n=await s.json();this.userId=n.userId,this.sessionId=n.id}toggleOpen(){this.loaded&&(this.open=!this.open,this.open?(""===this.sessionId?this.createSession():console.log("did not created a session"),0===this.company.ball?this.chatIcon.classList.add("hidden"):this.imageIcon.classList.add("hidden"),0===this.company.ball?this.closeIcon.classList.remove("hidden"):this.messageInti.classList.add("hidden"),this.showMessageContainer()):(this.chatIcon.classList.remove("hidden"),this.buttonContainer.style.backgroundColor="#000",this.buttonContainer.style.width="50px",this.buttonContainer.style.height="50px",this.buttonContainer.style.borderRadius="50%",this.messageContainer.classList.add("hidden"),this.closeIcon.classList.add("hidden"),this.container.removeChild(this.messageContainer)))}async submitAction(){let e={...this.step.steps[0]};var t=document.querySelector("#email").value;e.message=t,""!==t.trim()&&(this.ticket={...this.ticket,[this.textInput.name]:t},document.querySelector("#email").value="",this.messageViwer.appendChild(this.messageUser2(e)),this.updateScroll())}showMessageContainer(){this.messageContainer=document.createElement("div"),this.messageContainer.style.borderRadius="10px",this.messageContainer.classList.add("message-container"),this.messageContainer.style.opacity=0,this.messageContainer.style.transform="translateY(20px)",setTimeout(()=>{this.messageContainer.style.opacity=1},500),setTimeout(()=>{this.messageContainer.style.transform="translateY(0px)"},500);const e=document.createElement("div");e.classList.add("header"),e.style.borderRadius="10px 10px 0px 0px",e.style.backgroundColor=this.company.color;const t=document.createElement("h2");t.textContent=this.company.header,t.style.color=this.company.color2,t.style.fontSize="32px";const s=document.createElement("p");s.textContent=this.company.sublime,s.style.color=this.company.color2;const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="row",n.style.justifyContent="space-between",n.style.alignItems="center";const i=document.createElement("img");i.src=this.company.logo;const a=document.createElement("span");a.textContent="X",a.style.color="white",a.style.padding="20px",i.style.height="40px",i.style.marginLeft="15px",i.style.marginTop="15px",i.style.marginBottom="-15px",a.addEventListener("click",this.toggleOpen.bind(this)),n.appendChild(i),n.appendChild(a),e.appendChild(n),e.appendChild(t),e.appendChild(s);const o=document.createElement("div");o.id="messageViewer",o.style.backgroundColor="#efefef",o.style.overflowY="auto",o.style.height="300px",o.style.padding="15px",o.style.display="flex",o.style.flexDirection="column",this.messageViwer=o,this.loadFirstMessage();const d=document.createElement("div");d.style.display="none",d.style.backgroundColor="#efefef",d.style.padding="20px";const l=document.createElement("TEXTAREA");l.style.display="none",l.style.outline="none",l.style.fontSize="14px",l.required=!0,l.id="email",l.classList.add("input"),l.placeholder="message",l.style.width=0,l.addEventListener("keyup",e=>{"Enter"===e.key&&this.submitAction()}),this.textInput=l,d.appendChild(l),this.sendMenu=d,this.messageContainer.appendChild(e),this.messageContainer.appendChild(o),this.messageContainer.appendChild(d),this.container.appendChild(this.messageContainer)}async createTicket(){console.log(this.ticket),console.log(this.company),console.log(this.sessionId);const e={ticket:this.ticket,company:this.company,session:this.sessionId,IPv4:this.IPv4},t=await fetch("https://hubpluginserver.azurewebsites.net/tickets/createticket",{method:"POST",headers:{"Content-Type":"application/json",authorization:this.appid},body:JSON.stringify({...e})});await t.json();this.sendMenu.style.display="none"}messageUser2(e){const t=document.createElement("div");return t.style.marginTop="5px",t.style.padding="5px 10px 5px 10px",t.style.opacity=0,t.style.transform="translateY(-10px)",setTimeout(()=>{t.style.opacity=1},200),setTimeout(()=>{t.style.transform="translateY(0px)"},200),t.style.backgroundColor="white",t.style.borderRadius="10px",t.classList.add("messageUser2"),t.innerText=e.message,2===e.action&&t.addEventListener("click",()=>this.fetchNextStep(e)),4===e.action&&(this.delay(500),this.fetchNextStep(e)),t}messageAI(e){const t=document.createElement("div");return t.style.backgroundColor=this.company.color,t.classList.add("messageAI"),t.innerText=e.message,t.style.opacity=0,t.style.transform="translateY(10px)",setTimeout(()=>{t.style.opacity=1},200),setTimeout(()=>{t.style.transform="translateY(0px)"},200),t.style.opacity=1,t.style.padding="20px",e.action<0&&t.addEventListener("click",()=>this.fetchNextStep(e)),1===e.action&&this.fetchNextStep(e),3===e.action&&this.fetchNextStep(e),-1===e.action&&this.createTicket(),t}updateScroll(){var e=this.messageViwer;e.scrollTop=e.scrollHeight}async loadFirstMessage(){this.addLoadingMessage();const e=await fetch(`https://hubpluginserver.azurewebsites.net/steps/firststep?id=${this.appid}`,{method:"GET"}),t=await e.json();if(!t.parent)return this.toggleOpen;this.removeLoadinMessage(),this.messageViwer.appendChild(this.messageAI(t.parent))}console(e){console.log(e)}async fetchNextStep(e){this.addLoadingMessage();const t=await fetch(`https://hubpluginserver.azurewebsites.net/steps/fetchstep?id=${e.id}`,{method:"GET"}),s=await t.json();if(this.step=s,this.delay(200),this.removeLoadinMessage(),this.textInput.removeEventListener("keyup",this.console("a1")),-1===e.action)return this.toggleOpen();if(-10===e.action&&(await this.delay(1e3),this.messageViwer.appendChild(this.messageAI(s.steps[0]))),1===e.action)for(let e=0;e<s.steps.length;e++)await this.delay(500),this.messageViwer.appendChild(this.messageUser2(s.steps[e])),this.updateScroll();if(2===e.action)for(let e=0;e<s.steps.length;e++)await this.delay(500),this.messageViwer.appendChild(this.messageAI(s.steps[e])),this.updateScroll();3===e.action&&(this.sendMenu.style.display="flex",this.textInput.style.display="flex",this.textInput.style.width="100%",this.textInput.name=e.tag,this.updateScroll()),await this.delay(1e3),4===e.action&&(this.messageViwer.appendChild(this.messageAI(s.steps[0])),this.updateScroll())}}let script=document.getElementById("nortbHUB"),appid=script.getAttribute("appid");export const chat=new Chat({appid:appid});
