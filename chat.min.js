class Hubi{constructor({appid:t="",page:e="intro",openMenu:n=!1}){this.appid=t,this.page=e,this.openMenu=n,this.user="",this.sessionId="",this.company={id:"",name:""},this.open=!1,this.loaded=!1,this.load(this.appid),this.logo="",this.firstMessage="",this.IPv4="",this.createStyles(),this.ticket={problem:"",name:"",email:"",customTags:[]},this.activeTag="",this.action=-99,this.nextStep="",this.menu="",this.text=""}delay(t){return new Promise(e=>setTimeout(e,t))}createStyles(){const t=document.createElement("style");document.head.appendChild(t),t.innerHTML="\n            span{\n                font-family: 'Roboto', 'Arial', sans-serif;\n            }\n            .nametag{\n                font-family: 'Roboto', 'Arial', sans-serif;\n                letter-spacing: 1px;\n            }\n            .containeri{\n                bottom: 15px;\n                right: 15px;\n                position: fixed;\n                display: flex;\n                flex-direction: column;\n                -webkit-font-smoothing: antialiased;\n                -moz-osx-font-smoothing: grayscale;\n           \n            }\n            .button-container {\n                background-color: #777;\n                width: 50px;\n                height: 50px;\n                border-radius: 50%;\n                box-shadow: 0px 0px 31px 6px rgba(0,0,0,0.75);\n                transition: all 0.6s ease-in-out;\n                -webkit-font-smoothing: antialiased;\n                -moz-osx-font-smoothing: grayscale;\n            }\n            .button-container2 {\n                display: flex;\n                width: 250px;\n                height: 50px\n                flex-direction: row;\n                align-items: flex-end;\n                transition: all 0.6s ease-in-out;\n                \n            }\n            .icon{\n                cursor: pointer;\n                width: 50%;\n                position: absolute;\n                left: 50%;\n                margin-left: -12.5px;\n                top: 50%;\n                margin-top: -12.5px;\n                transition: transform .3s ease;\n            }\n\n            .imageCont {\n                min-width: 20px;\n                max-width: 20px;\n                max-height: 20px;\n                object-fit: cover;\n                border-radius: 50%;\n                margin-right: 5px;\n                transition: transform 0.6s ease;\n         \n            }\n            .initMessageCont{\n                border-radius: 10px;\n                background-color: #fff;\n                margin-left: 5px;\n                padding: 10px;\n                display: flex;\n                flex-direction: column;\n                cursor: pointer;\n                transition: transform 1s ease;\n                -webkit-font-smoothing: antialiased;\n                -moz-osx-font-smoothing: grayscale;\n            }\n            \n            .hidden{\n                transform: scale(0);\n            }\n         \n         \n       \n         \n            \n            .message-container{\n                box-shadow: 0 0 25px 18px rgba(0,0,0,0.1);\n                width: 375px;\n                right: 0px;\n                display: flex;\n                flex-direction: column;\n                bottom: 10px;\n                position: absolute;\n                transition:  all .5s ease;\n                font-family: Helvetica, Arial, sans-serif;\n                z-index: 999;\n                background-color: white;\n                border-radius: 20px;\n                -webkit-font-smoothing: antialiased;\n                -moz-osx-font-smoothing: grayscale;\n            }\n            \n            .message-container.hidden {\n                max-height: 0px;\n            }\n            \n            .message-container header{\n                display: flex;\n                flex-direction: column;\n                justify-content: flex-start\n                min-width: 100%;\n                padding: 20px;\n                -webkit-font-smoothing: antialiased;\n                -moz-osx-font-smoothing: grayscale;\n            }\n            \n            .message-container h2{\n                margin: 0;\n                font-size: 12px;\n                color: #fff;\n                font-weight: 500;\n                padding: 20px 30px 0px 30px;\n                -webkit-font-smoothing: antialiased;\n                -moz-osx-font-smoothing: grayscale;\n            }\n            \n            .message-container p{\n                margin: 0;\n                font-weight: 100;\n                padding: 10px 30px 60px 30px;\n                color: #ddd;\n                font-size: 16px;\n                -webkit-font-smoothing: antialiased;\n                -moz-osx-font-smoothing: grayscale;\n            }\n            \n            .AIBOT{\n                min-height: 400px;\n                max-height: 400px;\n                overflow: auto;\n                padding: 20px;\n                display: flex;\n                flex-direction: column;\n                transition: all .5 ease-in;\n                scroll-behavior: smooth;\n            }\n            \n            .messageAI{\n                 margin-bottom: 5px;\n                 margin-top: 5px;\n                 max-width: 50%;\n                 left: 10px;\n                 color: #fff\n                 padding: 20px;\n                 border-radius: 5px;\n                 color: white;\n                 font-size: 14px;\n                 opacity: 0;\n                 transition: all 0.5s;\n            }\n   \n            .messageUser2{\n                max-width: 50%;\n                margin-bottom: 5px;\n                margin-top: 5px;\n                border: 1px solid grey;\n                align-self: flex-end;\n                right: 10px;\n                background-color: white;\n                border-radius: 10px;\n                font-size: 13px;\n                cursor: pointer;\n                opacity: 0;\n                transition: all 0.2s;\n            }\n            \n            .sendMenu{\n                display: flex;\n                flex-direction: row;\n                align-items: center;\n                fontSize: 14px;\n            }\n            \n            .input {\n                padding: 10px;\n                width: 80%;\n                border: none;\n                border-bottom: 2px solid #ddd;\n            }\n            \n            .icon2 {\n                width: 30px;\n                height: 30px;\n                padding-left: 5px;\n                cursor: pointer;\n                align-self: center;\n            }\n            "}async load(t){const e=await fetch("https://geolocation-db.com/json/",{method:"GET"}),n=await e.json();this.IPv4=n.IPv4;const s=await fetch("http://localhost:3300/companies/company",{method:"POST",headers:{"Content-type":"application/json",authorization:t},body:JSON.stringify({IPv4:n.IPv4})}),i=await s.json();if(i.error)return this.loaded=!1;i.session.id&&(this.sessionId=this.sessionId),console.log(i),this.company={...i},this.ticket={enterprise:i.type=1},this.loaded=!0,this.initialise(this.company)}async initialise(t){if(await new Promise(t=>setTimeout(t,500)),0===t.ball){const e=document.createElement("div");e.classList.add("containeri"),e.id="hubcontainer",document.body.appendChild(e);const n=document.createElement("div");n.classList.add("button-container"),n.style.backgroundColor=t.color,n.style.opacity=0,n.style.transform="translateY(20px)",setTimeout(()=>{n.style.opacity=1},200),setTimeout(()=>{n.style.transform="translateY(0px)"},200);const s=document.createElement("img");s.src="https://www.nortb.com/img/chat1.svg",s.classList.add("icon"),this.chatIcon=s;const i=document.createElement("img");i.src="https://www.nortb.com/img/chat2.svg",i.classList.add("icon","hidden"),this.closeIcon=i,this.container=e,this.buttonContainer=n,e.appendChild(n),n.appendChild(this.chatIcon),n.appendChild(this.closeIcon),n.addEventListener("click",this.toggleOpen.bind(this)),n.classList.add("nonopac")}else{const e=document.createElement("div");e.classList.add("containeri"),document.body.appendChild(e);const n=await fetch("https://hubpluginserver.azurewebsites.net/companies/companyBall",{method:"POST",headers:{authorization:this.appid,"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}),s=await n.json(),i=document.createElement("div");i.classList.add("button-container2"),i.style.opacity=0,i.style.transform="translateY(20px)",setTimeout(()=>{i.style.opacity=1},200),setTimeout(()=>{i.style.transform="translateY(0px)"},200);const a=document.createElement("img"),o=document.createElement("img");o.src="https://www.nortb.com/img/chat1.svg",o.classList.add("icon"),o.classList.add("hidden"),this.chatIcon=o,a.classList.add("imageCont"),a.classList.add("visible"),a.src=s.img,this.imageIcon=a;const d=document.createElement("div");d.classList.add("initMessageCont"),this.messageInti=d;let l=document.createElement("span");l.innerText=s.message.message,l.style.fontSize="14px",l.style.color="#444";let r=document.createElement("span");r.classList.add("nametag"),r.innerText=`${s.name} from ${this.company.name}`,r.style.fontSize="12px",r.style.color="#777",this.message=l,this.message2=r,d.appendChild(this.message2),d.appendChild(this.message);const c=document.createElement("img");c.src="https://www.nortb.com/img/chat2.svg",c.classList.add("icon","hidden"),this.closeIcon=c,this.container=e,this.buttonContainer=i,e.appendChild(i),i.appendChild(this.imageIcon),i.appendChild(this.chatIcon),i.appendChild(this.messageInti),i.appendChild(this.closeIcon),i.addEventListener("click",this.toggleOpen.bind(this))}}addLoadingMessage(){const t=document.createElement("div");t.id="loading",t.classList.add("messageAI"),t.innerText="Loadingâ€¦",t.style.color="#777",t.style.opacity=1,t.style.padding="20px",this.loadingMessage=t,this.messageViwer.appendChild(t).scrollIntoView({behavior:"smooth"})}removeLoadinMessage(){this.messageViwer.removeChild(this.loadingMessage)}async createSession(){const t=await fetch("https://geolocation-db.com/json/",{method:"GET"}),e=await t.json(),n=await fetch("https://hubpluginserver.azurewebsites.net/sessions/createSession",{method:"POST",headers:{authorization:this.appid,"Content-type":"application/json"},body:JSON.stringify({IPv4:e.IPv4,company:this.company.id})}),s=await n.json();this.userId=s.userId,this.sessionId=s.id}toggleOpen(){this.loaded&&(this.open=!this.open,this.open?(""===this.sessionId?this.createSession():console.log("did not created a session"),this.chatIcon.classList.add("hidden"),this.buttonContainer.style.backgroundColor="#ffffff00",this.imageIcon.classList.add("hidden"),0===this.company.ball?this.closeIcon.classList.remove("hidden"):this.messageInti.classList.add("hidden"),this.showMessageContainer()):(this.chatIcon.classList.remove("hidden"),this.buttonContainer.style.backgroundColor=this.company.color,this.buttonContainer.style.width="50px",this.buttonContainer.style.height="50px",this.buttonContainer.style.borderRadius="50%",this.messageContainer.classList.add("hidden"),this.closeIcon.classList.add("hidden"),this.container.removeChild(this.messageContainer)))}async submitAction(){let t={...this.step.steps[0]};var e=document.querySelector("#email").value;t.message=e,""!==e.trim()&&(this.ticket={...this.ticket,[this.textInput.name]:e},document.querySelector("#email").value="",this.messageViwer.appendChild(this.messageUser2(t)),this.updateScroll())}showMessageContainer(){this.messageContainer=document.createElement("div"),this.messageContainer.style.borderRadius="10px",this.messageContainer.classList.add("message-container"),this.messageContainer.style.opacity=0,this.messageContainer.style.display="flex",this.messageContainer.style.flexDirection="column",this.messageContainer.style.transform="translateY(20px)",setTimeout(()=>{this.messageContainer.style.opacity=1},500),setTimeout(()=>{this.messageContainer.style.transform="translateY(0px)"},500);const t=document.createElement("div");t.classList.add("header"),t.style.width="100%",t.style.position="static",t.style.borderRadius="10px 10px 0px 0px",t.style.backgroundColor=this.company.color;const e=document.createElement("h2");e.textContent=this.company.header,e.style.color=this.company.color2,e.style.fontSize="28px",e.style.fontWeight=400;const n=document.createElement("p");n.textContent=this.company.sublime,n.style.color=this.company.color2;const s=document.createElement("div");s.style.display="flex",s.style.padding="30px 30px 0px 30px",s.style.flexDirection="row",s.style.justifyContent="space-between",s.style.alignItems="center";const i=document.createElement("img");i.src=this.company.plugin_logo;const a=document.createElement("span");a.textContent="X",a.style.color="white",i.style.width="200px",a.addEventListener("click",this.toggleOpen.bind(this)),s.appendChild(i),s.appendChild(a),t.appendChild(s),t.appendChild(e),t.appendChild(n);const o=document.createElement("div");o.id="messageViewer",o.style.backgroundColor="#efefef",o.style.overflowY="auto",o.style.height="450px",o.style.padding="15px",o.style.display="flex",o.style.flexDirection="column",o.style.position="static",o.style.borderRadius="0px 0px 20px 20px",this.messageViwer=o,this.loadFirstMessage();const d=document.createElement("div");d.style.display="none",d.style.backgroundColor="#efefef",d.style.padding="20px";const l=document.createElement("TEXTAREA");l.style.display="none",l.style.outline="none",l.style.fontSize="14px",l.required=!0,l.id="email",l.classList.add("input"),l.placeholder="message",l.style.width=0,l.addEventListener("keyup",t=>{"Enter"===t.key&&this.submitAction()}),this.textInput=l,d.appendChild(l),this.sendMenu=d,this.messageContainer.appendChild(t),this.messageContainer.appendChild(o),this.messageContainer.appendChild(d),this.container.appendChild(this.messageContainer)}async createTicket(){const t={ticket:this.ticket,company:this.company,session:this.sessionId,IPv4:this.IPv4},e=await fetch("https://hubpluginserver.azurewebsites.net/tickets/createticket",{method:"POST",headers:{"Content-Type":"application/json",authorization:this.appid},body:JSON.stringify({...t})});await e.json();this.sendMenu.style.display="none"}messageUser2(t){const e=document.createElement("div");return e.style.marginTop="5px",e.style.padding="5px 10px 5px 10px",e.style.opacity=0,e.style.transform="translateY(-10px)",setTimeout(()=>{e.style.opacity=1},200),setTimeout(()=>{e.style.transform="translateY(0px)"},200),e.style.backgroundColor="white",e.style.borderRadius="10px",e.classList.add("messageUser2"),e.innerText=t.message,2===t.action&&e.addEventListener("click",()=>this.fetchNextStep(t)),4===t.action&&(this.delay(500),this.fetchNextStep(t)),e}messageAI(t){const e=document.createElement("div");return e.style.backgroundColor=this.company.color,e.classList.add("messageAI"),e.innerText=t.message,e.style.opacity=0,e.style.transform="translateY(10px)",setTimeout(()=>{e.style.opacity=1},200),setTimeout(()=>{e.style.transform="translateY(0px)"},200),e.style.opacity=1,e.style.padding="20px",-10===t.action&&e.addEventListener("click",()=>this.fetchNextStep(t)),-9===t.action&&this.fetchNextStep(t),1===t.action&&this.fetchNextStep(t),3===t.action&&this.fetchNextStep(t),-1===t.action&&this.createTicket(),e}updateScroll(){var t=this.messageViwer;t.scrollTop=t.scrollHeight}async loadFirstMessage(){const t=await fetch(`https://hubpluginserver.azurewebsites.net/steps/firststep?id=${this.company.id}`,{method:"GET"}),e=await t.json();if(!e.parent)return this.toggleOpen;this.messageViwer.appendChild(this.messageAI(e.parent))}console(t){console.log(t)}async fetchNextStep(t){const e=await fetch(`https://hubpluginserver.azurewebsites.net/steps/fetchstep?id=${t.id}`,{method:"GET"}),n=await e.json();if(this.step=n,this.delay(200),this.messageViwer.scrollTop=this.messageViwer.scrollHeight,this.textInput.removeEventListener("keyup",this.console("a1")),-1===t.action)return this.toggleOpen();if(-10===t.action&&(await this.delay(1e3),this.messageViwer.appendChild(this.messageAI(n.steps[0]))),-9===t.action)for(let t=0;t<n.steps.length;t++)await this.delay(1e3),this.messageViwer.appendChild(this.messageUser2(n.steps[t]));if(1===t.action)for(let t=0;t<n.steps.length;t++)await this.delay(500),this.messageViwer.appendChild(this.messageUser2(n.steps[t]));if(2===t.action)for(let t=0;t<n.steps.length;t++)await this.delay(500),this.messageViwer.appendChild(this.messageAI(n.steps[t]));3===t.action&&(this.sendMenu.style.display="flex",this.textInput.style.display="flex",this.textInput.style.width="100%",this.textInput.name=t.tag),await this.delay(1e3),4===t.action&&this.messageViwer.appendChild(this.messageAI(n.steps[0]))}}export function AddChat({appid:t=""}){console.log(t);const e=new Hubi({appid:t});document.body.append(e)}
